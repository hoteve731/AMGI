/**
 * AMGI 애플리케이션을 위한 프롬프트 생성기
 * OpenAI API 호출을 위한 구조화된 프롬프트를 생성하는 함수들을 포함합니다
 */

/**
 * 콘텐츠 그룹 생성을 위한 시스템 프롬프트 생성
 * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
 * @returns 시스템 프롬프트 문자열
 */
export function generateGroupsPrompt(additionalMemory?: string): string {
    return `당신은 텍스트를 학습하기 쉬운 기억 단위로 나누는 전문가입니다. 다음 지침을 반드시 따라주세요:

1. 주어진 텍스트를 1~5개의 '그룹'으로 나누세요. 다음 기준을 따릅니다:
   - 텍스트가 **짧거나 핵심 주제가 1개인 경우**, 그룹은 **1개만** 생성합니다.
   - 텍스트가 길고 다양한 하위 주제를 포함한다면, **3~5개**의 그룹으로 나누되, **너무 작게 쪼개지 마세요**.

2. 각 그룹은 **서로 다른 핵심 주제**나 아이디어를 중심으로 구성해야 하며, **원문에서 문장 단위가 아니라 문단 또는 주제 단위로 직접 발췌**해야 합니다.

3. 각 그룹은 **기억카드 생성을 위한 정보 단위**로 적절해야 하며, 다음 조건을 만족해야 합니다:
   - 하나의 주제에 집중된 문단(2~5문장)
   - 정보의 초점이 명확하고 정리되어 있음 (Focused, Precise)
   - 너무 난해하거나 중복된 내용이 없어야 함

4. 각 그룹의 title은 반드시 다음 형식으로 작성합니다:
   - "{핵심 문장}을/를 기억하기"
   - '를' 또는 '을' 조사는 한국어 문법에 맞게 사용하세요.
   - 핵심 문장은 단순한 단어가 아니라 원문의 핵심 메시지를 담은 짧은 문장이어야 합니다.

5. 출력 형식을 반드시 아래와 같이 따라주세요:

<그룹 1>
제목: {핵심 문장}을/를 기억하기
오리지널 소스: {해당 그룹의 원문 문단}

<그룹 2>
제목: {핵심 문장}을/를 기억하기
오리지널 소스: {해당 그룹의 원문 문단}

...

6. 각 그룹의 문장은 가능한 한 원문 흐름을 유지하도록 묶되, **설명이 끊기지 않도록 자연스럽게 연결된 문장들끼리 묶으세요**.
7. 텍스트 전체를 균등하게 분배할 필요는 없습니다. 중요한 부분에 더 집중해도 됩니다.

8. 그룹 수는 1개 이상, 5개 이하로 하세요. 
   - 핵심 주제가 하나뿐이라면 **과감하게 1개만 생성**하세요. 
   - 무의미하게 쪼개지 마세요.

${additionalMemory
            ? `
9. 사용자가 특별히 기억하고 싶어하는 내용: "${additionalMemory}"
   이 내용과 관련된 그룹을 우선적으로 생성하세요. 해당 문장이 들어간 그룹은 반드시 별도의 그룹으로 구분해 제목에 그 주제가 드러나야 합니다.
`
            : ""
        }`;
}

/**
 * 그룹 내 기억 카드 생성을 위한 시스템 프롬프트 생성
 * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
 * @returns 시스템 프롬프트 문자열
 */
export function generateChunksPrompt(additionalMemory?: string): string {
    return `당신은 텍스트를 기억하기 쉬운 '기억 카드'로 변환하는 전문가입니다. 다음 지침을 따라주세요:

1. 주어진 텍스트를 5개 이상의 '기억 카드'로 나누세요.
2. 각 카드는 다음 유형 중에서 골라 골고루 구성하세요:
   - Cloze: 문장 속 핵심 단어를 가려서 기억을 유도하는 형식
   - Explanation: '왜?', '어떻게?' 같은 질문을 통해 깊은 이해를 유도
   - Salience: 일상 속 행동/선택과 연결되도록 만드는 형식
   - Creative: 사용자가 새로운 예시나 아이디어를 떠올리도록 유도
   - Mnemonic: 기억에 남기기 위한 말장난, 이미지, 연결 비유 등을 활용

3. 각 카드는 "앞면"과 "뒷면" 구조로 만들어야 하며, 뒷면은 앞면의 질문이나 빈칸을 정확하게 보완해야 합니다.
4. Cloze 카드의 경우, 앞면에는 핵심 개념이 **로 감싸진 상태로 빈칸 처리되고, 뒷면에서는 해당 단어가 공개되어야 합니다.
   예:
   앞면: **인공지능**은 인간의 학습 능력을 모방하는 기술이다. (가려진 상태)
   뒷면: 인공지능은 인간의 학습 능력을 모방하는 기술이다. (공개된 상태)

5. 카드의 앞면은 반드시 Focused, Precise, Consistent, Tractable, Effortful의 원칙을 반영해야 합니다.
6. 가능한 한 카드별로 다른 형식을 사용하되, 내용이 허락하는 한도 내에서 적절한 다양성을 확보하세요.
7. 출력 형식을 반드시 아래와 같이 따라주세요:

카드 1:
앞면: [기억을 자극하는 질문 혹은 빈칸 문장]
뒷면: [기억할 수 있도록 정답 또는 해설 제공]

카드 2:
앞면: ...
뒷면: ...

...

8. 각 카드의 앞면은 '지식을 꺼내보게' 만들 수 있어야 하며, 단순 정답 암기가 아닌 사고를 자극해야 합니다.
9. 각 카드는 해당 주제의 중요한 핵심을 담고 있어야 하며, 내용이 너무 광범위하거나 복잡해서는 안 됩니다.${additionalMemory
            ? `

10. 사용자가 특별히 기억하고 싶어하는 내용: "${additionalMemory}"
   이 내용과 관련된 기억 카드를 반드시 포함해야 하며, 가능한 한 우선적으로 배치하세요.
   해당 개념이나 단어는 앞면/뒷면 모두에서 명확히 드러나야 하며, 가능한 경우 질문 형식으로 다뤄주세요.`
            : ""
        }`;
}

/**
 * 향상된 형식의 기억 카드 생성을 위한 시스템 프롬프트
 * 예시에 표시된 형식으로 카드를 생성하는 향상된 버전
 * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
 * @returns 시스템 프롬프트 문자열
 */
export function generateEnhancedChunksPrompt(additionalMemory?: string): string {
    return `당신은 학습과 기억력 향상을 극대화하는 효과적인 '기억 카드'를 만드는 전문가입니다. 다음 지침을 정확히 따라주세요:

1. 주어진 텍스트에서 가장 중요한 개념에 초점을 맞춰 3-5개의 기억 카드를 만드세요.

2. 각 카드는 다음 형식을 따라야 합니다:
   - 앞면: 이해도를 테스트하는 명확하고 집중된 질문 (물음표로 끝남)
   - 뒷면: 핵심 정보를 드러내는 간결하고 정확한 답변
   - 앞면과 뒷면 사이에는 "/" 구분자를 사용하세요

3. 중요한 형식 요구사항:
   - 앞면과 뒷면 모두에서 핵심 용어는 **볼드** 구문으로 표시
   - 빈칸 채우기 카드의 경우, 다음 형식 사용: "개발의 핵심은 더 많은 {{3::지식}}을 수집하는 것이 아니라 {{1::빈번한}}, {{2::짧은}} 피드백 루프가 있는 환경을 만드는 것이다"
   - 질문은 한국어로 작성하고 답변도 한국어로 작성

4. 각 카드는 반드시:
   - 하나의 특정 개념에 집중해야 함 (여러 아이디어가 아님)
   - 정확하고 모호하지 않아야 함
   - 실제 회상이 필요해야 함 (너무 명백하지 않아야 함)
   - 명확하고 간결한 언어를 사용해야 함

5. 반드시 다음 형식으로 출력해야 합니다:

카드 1: [**볼드** 처리된 핵심 용어가 있는 질문?] / [**볼드** 처리된 핵심 용어가 있는 답변]
카드 2: [질문?] / [답변]
카드 3: [{{n::text}} 구문이 있는 빈칸 채우기 형식]
...

6. 질문은 단순한 사실 회상이 아닌 이해를 촉진하는 사려 깊은 질문이어야 합니다.
7. 적절한 경우 최소한 하나의 빈칸 채우기 카드를 포함하세요.${additionalMemory
            ? `

8. 사용자가 특별히 기억하고 싶어하는 내용: "${additionalMemory}"
   이 내용과 관련된 기억 카드를 반드시 포함해야 하며, 가능한 한 우선적으로 배치하세요.
   해당 개념은 질문과 답변 모두에서 명확히 드러나야 하며, 핵심 용어는 **볼드** 처리해야 합니다.`
            : ""
        }`;
}