/**
 * AMGI 애플리케이션을 위한 프롬프트 생성기
 * OpenAI API 호출을 위한 구조화된 프롬프트를 생성하는 함수들을 포함합니다
 */

/**
 * 콘텐츠 그룹 생성을 위한 시스템 프롬프트 생성
 * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
 * @returns 시스템 프롬프트 문자열
 */
export function generateGroupsPrompt(additionalMemory?: string): string {
   return `당신은 텍스트를 학습하기 쉬운 기억 단위로 나누는 전문가입니다. 다음 지침을 반드시 따라주세요:

1. 주어진 텍스트를 1~5개의 '그룹'으로 나누세요. 다음 기준을 따릅니다:
   - 텍스트가 **짧거나 핵심 주제가 1개인 경우**, 그룹은 **1개만** 생성합니다.
   - 텍스트가 길고 다양한 하위 주제를 포함한다면, **3~5개**의 그룹으로 나누되, **너무 작게 쪼개지 마세요**.

2. 각 그룹은 **서로 다른 핵심 주제**나 아이디어를 중심으로 구성해야 하며, **원문에서 문장 단위가 아니라 문단 또는 주제 단위로 직접 발췌**해야 합니다.

3. 각 그룹은 **기억카드 생성을 위한 정보 단위**로 적절해야 하며, 다음 조건을 만족해야 합니다:
   - 하나의 주제에 집중된 문단(2~5문장)
   - 정보의 초점이 명확하고 정리되어 있음 (Focused, Precise)
   - 너무 난해하거나 중복된 내용이 없어야 함

4. 각 그룹의 title은 반드시 다음 형식으로 작성합니다:
   - "{핵심 문장}을/를 기억하기"
   - '를' 또는 '을' 조사는 한국어 문법에 맞게 사용하세요.
   - 핵심 문장은 단순한 단어가 아니라 원문의 핵심 메시지를 담은 짧은 문장이어야 합니다. '을/를 기억하기' 문장에 자연스럽게 녹아들도록 하세요.

5. 출력 형식을 반드시 아래와 같이 따라주세요:

<그룹 1>
제목: {핵심 문장}을/를 기억하기
오리지널 소스: {해당 그룹의 원문 문단}

<그룹 2>
제목: {핵심 문장}을/를 기억하기
오리지널 소스: {해당 그룹의 원문 문단}

...

6. 각 그룹의 문장은 가능한 한 원문 흐름을 유지하도록 묶되, **설명이 끊기지 않도록 자연스럽게 연결된 문장들끼리 묶으세요**.
7. 텍스트 전체를 균등하게 분배할 필요는 없습니다. 중요한 부분에 더 집중해도 됩니다.

8. 그룹 수는 1개 이상, 5개 이하로 하세요. 
   - 핵심 주제가 하나뿐이라면 **과감하게 1개만 생성**하세요. 
   - 무의미하게 쪼개지 마세요.

${additionalMemory
         ? `
9. 사용자가 특별히 기억하고 싶어하는 내용: "${additionalMemory}"
   이 내용과 관련된 그룹을 우선적으로 생성하세요. 해당 문장이 들어간 그룹은 반드시 별도의 그룹으로 구분해 제목에 그 주제가 드러나야 합니다.
`
         : ""
      }`;
}

// /**
//  * 텍스트 분할을 위한 시스템 프롬프트 생성
//  * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
//  * @returns 시스템 프롬프트 문자열
//  */
// export function generateTextSplitPrompt(additionalMemory?: string): string {
//    return `당신은 텍스트를 학습하기 쉬운 기억 단위로 나누는 전문가입니다. 다음 지침을 반드시 따라주세요:

// 1. 주어진 텍스트를 1~5개의 '그룹'으로 나누세요. 다음 기준을 따릅니다:
//    - 텍스트가 **짧거나 핵심 주제가 1개인 경우**, 그룹은 **1개만** 생성합니다.
//    - 텍스트가 길고 다양한 하위 주제를 포함한다면, **3~5개**의 그룹으로 나누되, **너무 작게 쪼개지 마세요**.

// 2. 각 그룹은 **서로 다른 핵심 주제**나 아이디어를 중심으로 구성해야 하며, **원문에서 문장 단위가 아니라 문단 또는 주제 단위로 직접 발췌**해야 합니다.

// 3. 각 그룹은 **기억카드 생성을 위한 정보 단위**로 적절해야 하며, 다음 조건을 만족해야 합니다:
//    - 하나의 주제에 집중된 문단(2~5문장)
//    - 정보의 초점이 명확하고 정리되어 있음 (Focused, Precise)
//    - 너무 난해하거나 중복된 내용이 없어야 함

// 4. 출력 형식을 반드시 아래와 같이 따라주세요:

// <그룹 1>
// 오리지널 소스: {해당 그룹의 원문 문단}

// <그룹 2>
// 오리지널 소스: {해당 그룹의 원문 문단}

// ...

// 5. 각 그룹의 문장은 가능한 한 원문 흐름을 유지하도록 묶되, **설명이 끊기지 않도록 자연스럽게 연결된 문장들끼리 묶으세요**.
// 6. 텍스트 전체를 균등하게 분배할 필요는 없습니다. 중요한 부분에 더 집중해도 됩니다.

// 7. 그룹 수는 1개 이상, 5개 이하로 하세요. 
//    - 핵심 주제가 하나뿐이라면 **과감하게 1개만 생성**하세요. 
//    - 무의미하게 쪼개지 마세요.

// ${additionalMemory
//          ? `
// 8. 사용자가 특별히 기억하고 싶어하는 내용: "${additionalMemory}"
//    이 내용과 관련된 그룹을 우선적으로 생성하세요. 해당 문장이 들어간 그룹은 반드시 별도의 그룹으로 구분해야 합니다.
// `
//          : ""
//       }`;
// }

// /**
//  * 그룹 제목 생성을 위한 시스템 프롬프트
//  * @returns 시스템 프롬프트 문자열
//  */
// export function generateGroupTitlePrompt(): string {
//    return `당신은 학습 그룹에 효과적인 제목을 부여하는 전문가입니다. 다음 지침을 반드시 따라주세요:

// 1. 주어진 텍스트 그룹에 대해 핵심 메시지를 담은 제목을 생성하세요.

// 2. 제목은 반드시 다음 형식으로 작성합니다:
//    - "{핵심 문장}을/를 기억하기"
//    - '를' 또는 '을' 조사는 한국어 문법에 맞게 사용하세요.
//    - 핵심 문장은 단순한 단어가 아니라 원문의 핵심 메시지를 담은 짧은 문장이어야 합니다. '을/를 기억하기' 문장에 자연스럽게 녹아들도록 하세요.

// 3. 출력 형식은 다음과 같이 제목만 작성하세요:
//    {핵심 문장}을/를 기억하기
// `;
// }

/**
 * 기억 카드 생성을 위한 공통 프롬프트 부분 생성
 * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
 * @returns 공통 프롬프트 문자열
 */
// function generateCommonChunksPromptParts(additionalMemory?: string): { intro: string, outro: string } {
// 주석 처리: 새로운 통합 프롬프트 함수 내에서 직접 구성
// ... (기존 generateCommonChunksPromptParts 내용)
// }

/**
 * Cloze 형식의 기억 카드 생성을 위한 시스템 프롬프트
 * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
 * @returns 시스템 프롬프트 문자열
 */
export function generateClozeChunksPrompt(additionalMemory?: string): string {
   // 수정: generateCommonChunksPromptParts 호출 제거하고 직접 intro/outro 정의 또는 상수로 분리
   // const { intro, outro } = generateCommonChunksPromptParts(additionalMemory);
   const intro = `... (generateUnifiedChunksPrompt의 intro 부분 참고하여 Cloze용으로 재구성) ...`;
   const outro = `... (generateUnifiedChunksPrompt의 outro 부분 참고하여 Cloze용으로 재구성) ...`;

   return `${intro}

3. Cloze 기억 카드는 다음 형식을 따릅니다: 
   - 핵심 단어를 {{}}로 감싼 문장 (중요: 질문 형식이 아닙니다. 마침표로 끝나야 함.)
   - 앞면과 **동일한 문장**에서 핵심 단어를 {{}} 대신 **볼드** 처리한 문장
   - Cloze 카드 예시: {{간헐적 복습}}은 {{장기 기억}}에 유리하다. / **간헐적 복습**은 **장기 기억**에 유리하다.

4. 모든 카드는 반드시 Cloze 형식이어야 합니다. 질문/답변 형식의 카드는 생성하지 마세요.

5. 각 문장에는 1개의 핵심 단어만 {{}}로 감싸세요. 너무 많은 단어를 감싸면 학습 효과가 떨어집니다.

6. Cloze 카드는 반드시 1개 이상 생성해야 합니다.

${outro}`;
}

/**
 * 일반 형식의 기억 카드 생성을 위한 시스템 프롬프트
 * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
 * @returns 시스템 프롬프트 문자열
 */
export function generateNormalChunksPrompt(additionalMemory?: string): string {
   // 수정: generateCommonChunksPromptParts 호출 제거하고 직접 intro/outro 정의 또는 상수로 분리
   // const { intro, outro } = generateCommonChunksPromptParts(additionalMemory);
   const intro = `... (generateUnifiedChunksPrompt의 intro 부분 참고하여 Normal용으로 재구성) ...`;
   const outro = `... (generateUnifiedChunksPrompt의 outro 부분 참고하여 Normal용으로 재구성) ...`;

   return `${intro}

1. 모든 기억 카드는 다음 형식을 따릅니다:
   - 앞면과 뒷면 모두에서 핵심 단어는 **볼드** 구문으로 표시
   - 앞면: 이해도를 테스트하는 명확하고 집중된 질문 (항상 물음표로 끝나야 함)
   - 뒷면: 핵심 정보를 담은 간결하고 정확한 답변
   - 앞면과 뒷면은 / 구분자를 사용합니다.

2. 다음 3가지 유형의 카드를 골고루 포함하세요:
   1) Explanation: '왜?', '어떻게?'로 깊은 이해 유도. 예: 왜 **간헐적 복습**이 **장기 기억**에 효과적인가요? / **간헐적 복습**은 망각 곡선을 고려한 반복으로 **장기 기억**을 강화하기 때문입니다.
   2) Salience: 일상적 행동이나 선택과 연결. 예: 일상에서 **주의력 회복**을 위한 좋은 방법은? / **자연 속 산책**은 뇌의 주의 회로를 회복시키는 데 도움을 줍니다.
   3) Mnemonic: 기억을 돕기 위한 말장난, 비유. 예: **심장 판막** 순서를 기억하는 유쾌한 문장은? / \"Toilet Paper My Ass\" → **Tricuspid, Pulmonary, Mitral, Aortic**

3. 모든 카드는 반드시 질문/답변 형식이어야 합니다. Cloze 형식의 카드는 생성하지 마세요.

${outro}`;
}

// /**
//  * 향상된 형식의 기억 카드 생성을 위한 시스템 프롬프트 (하위 호환성 유지)
//  * 예시에 표시된 형식으로 카드를 생성하는 향상된 버전
//  * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
//  * @returns 시스템 프롬프트 문자열
//  */
// export function generateEnhancedChunksPrompt(additionalMemory?: string): string {
//    const { intro, outro } = generateCommonChunksPromptParts(additionalMemory);

//    return `${intro}

// 3. Cloze 기억 카드는 다름 형식을 따릅니다: 
//    - 앞면: 핵심 단어를 {{}}로 감싼 문장 (중요: 질문 형식이 아닙니다. 마침표로 끝나야 함.)
//    - 뒷면: 앞면과 **동일한 문장**에서 핵심 단어를 {{}} 대신 **볼드** 처리한 문장
//    - Cloze 기억 카드는 반드시 1개 이상 생성해야 합니다.
//    - Cloze 카드 예시: {{간헐적 복습}}은 {{장기 기억}}에 유리하다. / **간헐적 복습**은 **장기 기억**에 유리하다.

// 4. 나머지 기억 카드는 다음 형식을 따릅니다:
//    - 앞면과 뒷면 모두에서 핵심 단어는 **볼드** 구문으로 표시
//    - 앞면: 이해도를 테스트하는 명확하고 집중된 질문 (항상 물음표로 끝나야 함)
//    - 뒷면: 핵심 정보를 담은 간결하고 정확한 답변
//    - 앞면과 뒷면은 / 구분자를 사용합니다.
//    - 3개의 예시는 다음과 같습니다. 
//    1) Explanation: '왜?', '어떻게?'로 깊은 이해 유도. 예: 왜 **간헐적 복습**이 **장기 기억**에 효과적인가요? / **간헐적 복습**은 망각 곡선을 고려한 반복으로 **장기 기억**을 강화하기 때문입니다.
//    2) Salience: 일상적 행동이나 선택과 연결. 예:일상에서 **주의력 회복**을 위한 좋은 방법은? / **자연 속 산책**은 뇌의 주의 회로를 회복시키는 데 도움을 줍니다.
//    3) Mnemonic: 기억을 돕기 위한 말장난, 비유. 예: **심장 판막** 순서를 기억하는 유쾌한 문장은? / "Toilet Paper My Ass" → **Tricuspid, Pulmonary, Mitral, Aortic**

// 5. 카드 유형 비율: 약 30%는 Cloze 형식, 70%는 질문/답변 형식으로 구성하세요.

// ${outro}`;
// }

/**
 * 통합 형식 (Cloze + 일반) 기억 카드 생성을 위한 시스템 프롬프트
 * @param additionalMemory 사용자가 기억하고 싶은 내용에 대한 선택적 입력
 * @returns 시스템 프롬프트 문자열
 */
export function generateUnifiedChunksPrompt(additionalMemory?: string): string {
   // 수정: Cloze 형식 및 일반 카드 볼드 처리 지침 강화
   const intro = `당신은 학습과 기억력 향상을 극대화하는 효과적인 \'기억 카드\'를 만드는 전문가입니다. 다음 지침을 **매우 정확하게** 따라주세요:\n\n1. 주어진 텍스트 그룹에 대해, 가장 중요하고 기억할 만한 내용을 중심으로 **정확히 2~5개**의 \'기억 카드\'를 생성하세요. 오직 주어진 텍스트 내용만을 활용하세요.\n\n2. 반드시 다음 두 가지 유형의 카드를 **지정된 비율로 혼합**하여 생성해야 합니다:\n   - **Cloze 카드 (약 30~40% 비율):** 아래 3-1 형식 규칙을 따릅니다.\n   - **일반 카드 (질문/답변, 약 60~70% 비율):** 아래 3-2 형식 규칙을 따릅니다.\n\n3. 모든 카드는 다음 **매우 엄격한 형식**을 따라야 합니다:\n   - 각 카드는 반드시 "카드 N: "으로 시작합니다. (N은 1부터 시작하는 순차적 번호)\n   - 앞면과 뒷면은 반드시 ' / ' (슬래시 양쪽에 공백) 구분자를 사용합니다.\n\n   **3-1. Cloze 카드 형식 규칙:**\n    Cloze 기억 카드는 다음 형식을 따릅니다: 
   - Cloze 카드 예시: {{간헐적 복습}}은 {{장기 기억}}에 유리하다. / **간헐적 복습**은 **장기 기억**에 유리하다. - 앞면: 문장의 핵심 키워드 **하나 또는 두 개**를 {{}}로 감싼 완전한 문장.\n     - 뒷면: 앞면과 **완전히 동일한 문장**이어야 하며, {{}}로 감쌌던 동일한 키워드를 **(별표 두 개)로 감싸서 표시합니다.\"\n\n   **3-2. 일반 카드 형식 규칙:**\n     - 앞면: 명확하고 구체적인 질문. 반드시 물음표(?)로 끝나야 합니다. 질문 내의 핵심 키워드는 **로 감싸세요.\n     - 뒷면: 질문에 대한 간결하고 정확한 답변. 반드시 **마침표(.)**로 끝나야 합니다. 답변 내의 핵심 키워드도 **로 감싸세요.\n     - **일반 카드 예시:** \"카드 N: **간헐적 복습**이 **장기 기억**에 효과적인 이유는 무엇인가요? / **간헐적 복습**은 망각 곡선을 고려하여 **장기 기억**을 강화하기 때문입니다.\"\n     - (Explanation, Salience, Mnemonic 유형을 자연스럽게 포함시키세요.)\n\n4. 카드 생성 시 다음 5가지 원칙을 준수하세요:\n   - Focused: 하나의 명확한 개념 또는 사실에 집중\n   - Precise: 모호함 없이 정확하게\n   - Consistent: 일관된 스타일과 용어 사용\n   - Tractable: 너무 어렵거나 쉽지 않은 적절한 난이도\n   - Effortful: 단순 암기보다 이해와 회상을 유도`;

   const outro = `5. 출력은 반드시 위에서 설명한 **엄격한 형식**(\"카드 N: 앞면 / 뒷면\")만 포함해야 합니다. 각 카드는 새 줄로 구분하세요. 다른 어떤 설명, 머리말, 꼬리말도 **절대** 추가하지 마세요.\n\n${additionalMemory
      ? `6. 사용자가 특별히 기억하고 싶어하는 내용: \"${additionalMemory}\"\n   이 내용과 관련된 기억 카드를 최소 1개 이상 반드시 포함하세요. 해당 내용이 카드에서 명확히 드러나야 합니다.`
      : "\"\""
      }`;

   return `${intro}\n\n${outro}`;
}